<<<<<<< HEAD
module.exports=(()=>{"use strict";var e={57:(e,t,n)=>{n.d(t,{g:()=>te,T:()=>ne});const r=require("path");var s=n.n(r);const a=require("fastify");var o=n.n(a);require("fastify-cors");const i=require("fastify-static");var l=n.n(i);const c=require("open");var d=n.n(c);const p=require("portfinder"),m=(require("velona"),require("fs"));var u=n.n(m);const v=require("os"),y=require("cross-spawn");var f=n.n(y);const g={mysql:{port:3306},postgresql:{port:5432}},h={mysql:{name:"mysql",ver:"^2.18.1",port:3306},postgres:{name:"pg",ver:"^8.5.1",port:5432}},b=[{name:"dir",message:"Directory name (create new)",type:"input"},{name:"server",message:"Server engine",type:"list",choices:[{name:"Fastify (5x faster)",value:"fastify"},{name:"Express",value:"express"}],default:"fastify"},{name:"client",message:"Client framework",choices:[{name:"Next.js (React)",value:"next"},{name:"Nuxt.js (Vue)",value:"nuxt"},{name:"Sapper (Svelte)",value:"sapper"}],type:"list",default:"next"},{name:"building",message:"Building mode",type:"list",choices:[{name:"Static (export)",value:"static"},{name:"Basic (build)",value:"basic"}],default:"static",when:e=>"next"===e.client||"sapper"===e.client},{name:"mode",message:"Rendering mode",type:"list",choices:[{name:"Single Page App",value:"spa"},{name:"Universal (SSR / SSG)",value:"universal"}],default:"spa",when:e=>"nuxt"===e.client},{name:"target",message:"Deployment target",type:"list",choices:[{name:"Static (JAMStack hosting)",value:"static"},{name:"Server (Node.js hosting)",value:"server"}],default:"static",when:e=>"nuxt"===e.client},{name:"aspida",message:"HTTP client of aspida",choices:[{name:"axios",value:"axios"},{name:"fetch",value:"fetch"}],type:"list",default:"axios"},{name:"daemon",message:"Daemon process manager",choices:[{name:"None",value:"none"},{name:"PM2",value:"pm2"}],type:"list",default:"none"},{name:"orm",message:"O/R mapping tool",choices:[{name:"Prisma (recommended)",value:"prisma"},{name:"TypeORM",value:"typeorm"},{name:"None",value:"none"}],type:"list",default:"prisma"},{name:"prismaDB",message:"Database type of Prisma",choices:[{name:"SQLite",value:"sqlite"},{name:"MySQL",value:"mysql"},{name:"PostgreSQL",value:"postgresql"}],type:"list",default:"sqlite",when:e=>"prisma"===e.orm},{name:"typeormDB",message:"Database type of TypeORM",choices:[{name:"MySQL",value:"mysql"},{name:"PostgreSQL",value:"postgres"}],type:"list",default:"mysql",when:e=>"typeorm"===e.orm},{name:"dbHost",message:"server/prisma/.env HOST=",default:"localhost",type:"input",when:e=>"prisma"===e.orm&&"sqlite"!==e.prismaDB},{name:"dbHost",message:"server/.env TYPEORM_HOST=",type:"input",default:"localhost",when:e=>"typeorm"===e.orm},{name:"dbPort",message:"server/prisma/.env PORT=",type:"input",default:e=>{var t,n;return`${null!==(n=null===(t=g[e.prismaDB])||void 0===t?void 0:t.port)&&void 0!==n?n:""}`},when:e=>"prisma"===e.orm&&"sqlite"!==e.prismaDB},{name:"dbPort",message:"server/.env TYPEORM_PORT=",type:"input",default:e=>{var t,n;return`${null!==(n=null===(t=h[e.typeormDB])||void 0===t?void 0:t.port)&&void 0!==n?n:""}`},when:e=>"typeorm"===e.orm},{name:"dbUser",message:"server/prisma/.env USER=",type:"input",when:e=>"prisma"===e.orm&&"sqlite"!==e.prismaDB},{name:"dbUser",message:"server/.env TYPEORM_USERNAME=",type:"input",when:e=>"typeorm"===e.orm},{name:"dbPass",message:"server/prisma/.env PASSWORD=",type:"input",when:e=>"prisma"===e.orm&&"sqlite"!==e.prismaDB},{name:"dbPass",message:"server/.env TYPEORM_PASSWORD=",type:"input",when:e=>"typeorm"===e.orm},{name:"dbName",message:"server/prisma/.env DATABASE=",type:"input",when:e=>"prisma"===e.orm&&"sqlite"!==e.prismaDB},{name:"dbName",message:"server/.env TYPEORM_DATABASE=",type:"input",when:e=>"typeorm"===e.orm},{name:"dbFile",message:"server/prisma/.env DATABASE_FILE=",type:"input",default:"./dev.db",when:e=>"prisma"===e.orm&&"sqlite"===e.prismaDB},{name:"testing",message:"Testing framework",choices:[{name:"None",value:"none"},{name:"Jest",value:"jest"}],type:"list",default:"none"},{name:"pm",message:"Package manager",choices:[{name:"Yarn",value:"yarn"},{name:"Npm",value:"npm"}],type:"list",default:"yarn"},{name:"ci",message:"CI config",choices:[{name:"GitHub Actions",value:"actions"},{name:"None",value:"none"}],type:"list",default:"actions"}],w=require("ejs");var O=n.n(w);const P=require("majo"),D=require("is-binary-path");var S=n.n(D),j=function(e,t,n,r){return new(n||(n=Promise))((function(s,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function i(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}l((r=r.apply(e,t||[])).next())}))};let q="waiting";const x=()=>q,$=require("chalk");var B=n.n($);const E=require("ora");var T=n.n(E);const A=require("log-update");var R=n.n(A);const N=(e,t)=>new Promise(((n,r)=>{const s=T()();s.start(`Installing packages with ${t}`);const a=f()(t,["install"],{stdio:[0,"pipe","pipe"],cwd:e,env:Object.assign({FORCE_COLOR:!0,npm_config_color:"always",npm_config_progress:!0},process.env)});let o="",i="";a.stdout&&a.stdout.setEncoding("utf8").on("data",(e=>{"pnpm"===t?o=e:o+=e,s.stop(),R()(o),s.start()})),a.stderr&&a.stderr.setEncoding("utf8").on("data",(e=>{"pnpm"===t?i=e:i+=e,s.stop(),R().clear(),R().stderr(i),R()(o),s.start()})),a.on("close",(t=>{if(s.stop(),0!==t)throw new Error(`Failed to install packages in ${e}`);R().clear(),R().stderr.clear(),n()})),a.on("error",r)}));let _;const M=()=>(_=null!=_?_:(0,p.getPortPromise)({port:8080}),_);var F=function(e,t,n,r){return new(n||(n=Promise))((function(s,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function i(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}l((r=r.apply(e,t||[])).next())}))},k=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(n[r[s]]=e[r[s]])}return n};const C=(0,r.join)((0,v.homedir)(),".frourio"),U=(0,r.join)(C,"create-frourio-app.json");let H;const L=[{ver:2,handler:e=>{var t=e.answers,{front:n}=t,r=k(t,["front"]);return{ver:2,answers:Object.assign(Object.assign({},r),{client:n})}}}],I=[{when:e=>"front"in e,warn:'Use "client" instead of "front".',handler:e=>{var{front:t}=e,n=k(e,["front"]);return Object.assign(Object.assign({},n),{client:t})}}];try{const e=JSON.parse(u().readFileSync(U,"utf8"));H=e.ver>L.length?e:L.slice(L.findIndex((t=>t.ver===e.ver+1))).reduce(((e,t)=>t.handler(e)),e)}catch(e){H={ver:2,answers:{}}}const J=e=>(e=>{const t=Object.assign({},e);return b.forEach((n=>{var r,s;!1!==(null===(r=n.when)||void 0===r?void 0:r.call(n,t))&&(t[n.name]=null!==(s=e[n.name])&&void 0!==s?s:"function"==typeof n.default?n.default(t):n.default)})),b.filter((e=>{var n;return!1!==(null===(n=e.when)||void 0===n?void 0:n.call(e,t))})).map((e=>Object.entries(e).reduce(((e,[n,r])=>Object.assign(Object.assign({},e),{[n]:"function"==typeof r?r(t):r})),{})))})(e).reduce(((t,n)=>{var r;return Object.assign(Object.assign({},t),{[n.name]:null!==(r=e[n.name])&&void 0!==r?r:n.default})}),{}),Y=e=>F(void 0,void 0,void 0,(function*(){var t,n;q="installing";const a=J(e),o=null!==(t=a.dir)&&void 0!==t?t:"";yield((e,t,n)=>j(void 0,void 0,void 0,(function*(){var r;const a=(e=>{const t=Object.assign(Object.assign({prismaDB:"none"},e),{dbModule:"",dbUrl:""}),n=[{type:"add",files:"**",templateDir:`core/${e.server}`}];return"typeorm"===e.orm&&n.push({type:"add",files:"**",templateDir:`core/${e.server}-typeorm`}),"none"!==e.daemon&&n.push({type:"add",files:"**",templateDir:`daemon/${e.daemon}`}),t.dbModule="","prisma"===e.orm?(t.dbUrl="sqlite"===e.prismaDB?`file:${e.dbFile}`:`${e.prismaDB}://${e.dbUser}:${e.dbPass}@${e.dbHost}:${e.dbPort}/${e.dbName}`,n.push({type:"add",files:"**",templateDir:"orm/prisma"})):"typeorm"===e.orm&&(t.dbModule=`",\n    "${h[e.typeormDB].name}": "${h[e.typeormDB].ver}`,n.push({type:"add",files:"**",templateDir:"orm/typeorm"})),"none"!==e.testing&&(n.push({type:"add",files:"**",templateDir:`testing/${e.testing}`}),"nuxt"===e.client&&n.push({type:"add",files:"**",templateDir:"testing/nuxt"})),"none"!==e.ci&&n.push({type:"add",files:"**",templateDir:`ci/${e.ci}`}),{answers:t,actions:[{type:"add",files:"**",templateDir:`client/${e.client}`},{type:"add",files:"server/**",templateDir:""},...n,{type:"move",patterns:{gitignore:".gitignore"}}]}})(e),o=null!==(r=null!=n?n:e.dir)&&void 0!==r?r:"";for(const e of a.actions)"add"===e.type?yield(0,P.majo)().source([e.files],{baseDir:s().resolve(t,"templates",e.templateDir)}).use((e=>{Object.keys(e.files).filter((e=>!S()(e))).forEach((t=>{e.writeContents(t,O().render(e.files[t].contents.toString().replace(/\r/g,""),a.answers))}))})).dest(o):"move"===e.type&&(yield Promise.all(Object.keys(e.patterns).map((t=>j(void 0,void 0,void 0,(function*(){const n=s().join(o,t),r=s().join(o,e.patterns[t]);yield u().promises.copyFile(n,r),yield u().promises.unlink(n)}))))))})))(Object.assign(Object.assign({},a),{clientPort:ne.client,serverPort:yield M()}),__dirname),yield(e=>{return t=void 0,n=void 0,a=function*(){var t,n;const s=null!==(t=e.dir)&&void 0!==t?t:"",a=null!==(n=e.pm)&&void 0!==n?n:"";f().sync("git",["init"],{stdio:"ignore",cwd:s}),yield N(s,a),yield N(`${s}/server`,a),f().sync(a,["run","build:types"],{cwd:s,stdio:"inherit"});const o=s!==process.cwd(),i=(0,r.relative)(process.cwd(),s),l=o?B()`\n\t{cyan cd ${i}}\n`:"",c=`${a}${"npm"===a?" run":""}`;console.log(B()`\nðŸŽ‰  {bold Successfully created project} {cyan ${s}}\n`),console.log(B()`  {bold To get started:}`),"none"===e.orm||"typeorm"!==e.orm&&"sqlite"===e.prismaDB||console.log(B()`\t{cyan (start ${"prisma"===e.orm?e.prismaDB:e.typeormDB} server yourself)}`),console.log(B()`${l}\t{cyan ${c} dev}\n`),console.log(B()`  {bold To build & start for production:}`),"none"===e.orm||"typeorm"!==e.orm&&"sqlite"===e.prismaDB||console.log(B()`\t{cyan (start ${"prisma"===e.orm?e.prismaDB:e.typeormDB} server yourself)}`),console.log(B()`${l}\t{cyan ${c} build}`),console.log(B()`\t{cyan ${c} start}\n`)},new((s=void 0)||(s=Promise))((function(e,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function i(e){try{l(a.throw(e))}catch(e){r(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(o,i)}l((a=a.apply(t,n||[])).next())}));var t,n,s,a})(a),yield te.close(),f()(null!==(n=e.pm)&&void 0!==n?n:"npm",["run","dev"],{cwd:(0,r.resolve)(o),stdio:"inherit"}),delete H.answers.dir,delete H.answers.dbName,yield u().promises.writeFile(U,JSON.stringify(H),"utf8")})),Q=e=>F(void 0,void 0,void 0,(function*(){"waiting"===x()&&(H=Object.assign(Object.assign({},H),{answers:e}),u().existsSync(C)||(yield u().promises.mkdir(C)),yield u().promises.writeFile(U,JSON.stringify(H),"utf8"),yield Y(e))})),G=()=>({get:()=>({status:200,body:Object.assign({dir:process.argv[2]},H.answers)}),patch:({body:e})=>(Q(e),{status:204})});const W=require("mariadb");var K=n.n(W);const V=require("pg");const X=function(e,t){return e}((()=>({post:({body:e})=>{return t=void 0,n=void 0,s=function*(){var t;const n=J(e);if("none"===n.orm||"sqlite"===n.prismaDB)return{status:200,body:{enabled:!0}};try{const e={host:n.dbHost,port:+`${n.dbPort}`,user:n.dbUser,password:n.dbPass};if("mysql"===(null!==(t=n.prismaDB)&&void 0!==t?t:n.typeormDB)){const t=yield K().createConnection(e);"typeorm"===n.orm&&(yield t.query(`CREATE DATABASE IF NOT EXISTS ${n.dbName}`)),yield t.end()}else{const t=new V.Client(Object.assign(Object.assign({},e),{database:"postgres"}));yield t.connect(),"typeorm"===n.orm&&(yield t.query("SELECT datname FROM pg_database")).rows.every((e=>e.datname!==n.dbName))&&(yield t.query(`CREATE DATABASE ${n.dbName}`)),yield t.end()}return{status:200,body:{enabled:!0}}}catch(e){return{status:200,body:"prisma"===n.orm&&e.message.includes("allowPublicKeyRetrieval")?{enabled:!0}:{enabled:!1,err:e.message}}}},new((r=void 0)||(r=Promise))((function(e,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function i(e){try{l(s.throw(e))}catch(e){a(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(o,i)}l((s=s.apply(t,n||[])).next())}));var t,n,r,s}})));const z=function(e,t){return e}((()=>({get:()=>{return e=void 0,t=void 0,r=function*(){return{status:200,body:{status:x(),serverPort:yield M()}}},new((n=void 0)||(n=Promise))((function(s,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function i(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}l((r=r.apply(e,t||[])).next())}));var e,t,n,r}})));const Z=e=>(t,n)=>{const r=e(t);r.headers&&n.headers(r.headers),n.code(r.status).send(r.body)},ee=e=>(t,n)=>{return r=void 0,s=void 0,o=function*(){const r=yield e(t);r.headers&&n.headers(r.headers),n.code(r.status).send(r.body)},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{l(o.next(e))}catch(e){t(e)}}function i(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){var r;t.done?e(t.value):(r=t.value,r instanceof a?r:new a((function(e){e(r)}))).then(n,i)}l((o=o.apply(r,s||[])).next())}));var r,s,a,o};const te=o()(),ne={client:3e3};(0,p.getPortPromise)({port:ne.client}).then((e=>{return t=void 0,n=void 0,a=function*(){ne.client=e;const t=process.argv.indexOf("--answers");-1!==t?yield Q(I.reduce(((e,t)=>t.when(e)?(console.warn(t.warn),t.handler(e)):e),JSON.parse(process.argv[t+1]))):(te.register(l(),{root:s().join(__dirname,"../out")}),yield((e,t={})=>{var n;const r=null!==(n=t.basePath)&&void 0!==n?n:"",s=G(e),a=X(e),o=z(e);return e.get(`${r}/answers`,Z(s.get)),e.patch(`${r}/answers`,Z(s.patch)),e.post(`${r}/dbConnection`,ee(a.post)),e.get(`${r}/status`,ee(o.get)),e})(te,{basePath:"/api"}).listen(e));const n=yield d()(`http://localhost:${e}`);n.on("error",(()=>{console.log(`open http://localhost:${e} in the browser`)})),n.on("close",(()=>{console.log(`open http://localhost:${e} in the browser`)}))},new((r=void 0)||(r=Promise))((function(e,s){function o(e){try{l(a.next(e))}catch(e){s(e)}}function i(e){try{l(a.throw(e))}catch(e){s(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(o,i)}l((a=a.apply(t,n||[])).next())}));var t,n,r,a}))}},t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}return n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n(57)})().default;
=======
module.exports=(()=>{"use strict";var e={57:(e,t,n)=>{n.d(t,{g:()=>te,T:()=>ne});const r=require("path");var s=n.n(r);const a=require("fastify");var o=n.n(a);require("fastify-cors");const i=require("fastify-static");var l=n.n(i);const c=require("open");var d=n.n(c);const p=require("portfinder"),m=(require("velona"),require("fs"));var u=n.n(m);const v=require("os"),y=require("cross-spawn");var f=n.n(y);const g={mysql:{port:3306},postgresql:{port:5432}},h={mysql:{name:"mysql",ver:"^2.18.1",port:3306},postgres:{name:"pg",ver:"^8.5.1",port:5432}},b=[{name:"dir",message:"Directory name (create new)",type:"input"},{name:"server",message:"Server engine",type:"list",choices:[{name:"Fastify (5x faster)",value:"fastify"},{name:"Express",value:"express"}],default:"fastify"},{name:"client",message:"Client framework",choices:[{name:"Next.js (React)",value:"next"},{name:"Nuxt.js (Vue)",value:"nuxt"},{name:"Sapper (Svelte)",value:"sapper"}],type:"list",default:"next"},{name:"building",message:"Building mode",type:"list",choices:[{name:"Static (export)",value:"static"},{name:"Basic (build)",value:"basic"}],default:"static",when:e=>"next"===e.client||"sapper"===e.client},{name:"mode",message:"Rendering mode",type:"list",choices:[{name:"Single Page App",value:"spa"},{name:"Universal (SSR / SSG)",value:"universal"}],default:"spa",when:e=>"nuxt"===e.client},{name:"target",message:"Deployment target",type:"list",choices:[{name:"Static (JAMStack hosting)",value:"static"},{name:"Server (Node.js hosting)",value:"server"}],default:"static",when:e=>"nuxt"===e.client},{name:"aspida",message:"HTTP client of aspida",choices:[{name:"axios",value:"axios"},{name:"fetch",value:"fetch"}],type:"list",default:"axios"},{name:"daemon",message:"Daemon process manager",choices:[{name:"None",value:"none"},{name:"PM2",value:"pm2"}],type:"list",default:"none"},{name:"orm",message:"O/R mapping tool",choices:[{name:"Prisma (recommended)",value:"prisma"},{name:"TypeORM",value:"typeorm"},{name:"None",value:"none"}],type:"list",default:"prisma"},{name:"prismaDB",message:"Database type of Prisma",choices:[{name:"SQLite",value:"sqlite"},{name:"MySQL",value:"mysql"},{name:"PostgreSQL",value:"postgresql"}],type:"list",default:"sqlite",when:e=>"prisma"===e.orm},{name:"typeormDB",message:"Database type of TypeORM",choices:[{name:"MySQL",value:"mysql"},{name:"PostgreSQL",value:"postgres"}],type:"list",default:"mysql",when:e=>"typeorm"===e.orm},{name:"dbHost",message:"server/prisma/.env HOST=",default:"localhost",type:"input",when:e=>"prisma"===e.orm&&"sqlite"!==e.prismaDB},{name:"dbHost",message:"server/.env TYPEORM_HOST=",type:"input",default:"localhost",when:e=>"typeorm"===e.orm},{name:"dbPort",message:"server/prisma/.env PORT=",type:"input",default:e=>{var t,n;return`${null!==(n=null===(t=g[e.prismaDB])||void 0===t?void 0:t.port)&&void 0!==n?n:""}`},when:e=>"prisma"===e.orm&&"sqlite"!==e.prismaDB},{name:"dbPort",message:"server/.env TYPEORM_PORT=",type:"input",default:e=>{var t,n;return`${null!==(n=null===(t=h[e.typeormDB])||void 0===t?void 0:t.port)&&void 0!==n?n:""}`},when:e=>"typeorm"===e.orm},{name:"dbUser",message:"server/prisma/.env USER=",type:"input",when:e=>"prisma"===e.orm&&"sqlite"!==e.prismaDB},{name:"dbUser",message:"server/.env TYPEORM_USERNAME=",type:"input",when:e=>"typeorm"===e.orm},{name:"dbPass",message:"server/prisma/.env PASSWORD=",type:"input",when:e=>"prisma"===e.orm&&"sqlite"!==e.prismaDB},{name:"dbPass",message:"server/.env TYPEORM_PASSWORD=",type:"input",when:e=>"typeorm"===e.orm},{name:"dbName",message:"server/prisma/.env DATABASE=",type:"input",when:e=>"prisma"===e.orm&&"sqlite"!==e.prismaDB},{name:"dbName",message:"server/.env TYPEORM_DATABASE=",type:"input",when:e=>"typeorm"===e.orm},{name:"dbFile",message:"server/prisma/.env DATABASE_FILE=",type:"input",default:"./dev.db",when:e=>"prisma"===e.orm&&"sqlite"===e.prismaDB},{name:"testing",message:"Testing framework",choices:[{name:"Jest",value:"jest"},{name:"None",value:"none"}],type:"list",default:"jest"},{name:"pm",message:"Package manager",choices:[{name:"Yarn",value:"yarn"},{name:"Npm",value:"npm"}],type:"list",default:"yarn"},{name:"ci",message:"CI config",choices:[{name:"GitHub Actions",value:"actions"},{name:"None",value:"none"}],type:"list",default:"actions"}],w=require("ejs");var O=n.n(w);const P=require("majo"),D=require("is-binary-path");var j=n.n(D),S=function(e,t,n,r){return new(n||(n=Promise))((function(s,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function i(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}l((r=r.apply(e,t||[])).next())}))};let q="waiting";const $=()=>q,x=require("chalk");var B=n.n(x);const E=require("ora");var T=n.n(E);const A=require("log-update");var R=n.n(A);const N=(e,t)=>new Promise(((n,r)=>{const s=T()();s.start(`Installing packages with ${t}`);const a=f()(t,["install"],{stdio:[0,"pipe","pipe"],cwd:e,env:Object.assign({FORCE_COLOR:!0,npm_config_color:"always",npm_config_progress:!0},process.env)});let o="",i="";a.stdout&&a.stdout.setEncoding("utf8").on("data",(e=>{"pnpm"===t?o=e:o+=e,s.stop(),R()(o),s.start()})),a.stderr&&a.stderr.setEncoding("utf8").on("data",(e=>{"pnpm"===t?i=e:i+=e,s.stop(),R().clear(),R().stderr(i),R()(o),s.start()})),a.on("close",(t=>{if(s.stop(),0!==t)throw new Error(`Failed to install packages in ${e}`);R().clear(),R().stderr.clear(),n()})),a.on("error",r)}));let _;const M=()=>(_=null!=_?_:(0,p.getPortPromise)({port:8080}),_);var F=function(e,t,n,r){return new(n||(n=Promise))((function(s,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function i(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}l((r=r.apply(e,t||[])).next())}))},k=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(n[r[s]]=e[r[s]])}return n};const C=(0,r.join)((0,v.homedir)(),".frourio"),U=(0,r.join)(C,"create-frourio-app.json");let H;const L=[{ver:2,handler:e=>{var t=e.answers,{front:n}=t,r=k(t,["front"]);return{ver:2,answers:Object.assign(Object.assign({},r),{client:n})}}}],I=[{when:e=>"front"in e,warn:'Use "client" instead of "front".',handler:e=>{var{front:t}=e,n=k(e,["front"]);return Object.assign(Object.assign({},n),{client:t})}}];try{const e=JSON.parse(u().readFileSync(U,"utf8"));H=e.ver>L.length?e:L.slice(L.findIndex((t=>t.ver===e.ver+1))).reduce(((e,t)=>t.handler(e)),e)}catch(e){H={ver:2,answers:{}}}const J=e=>(e=>{const t=Object.assign({},e);return b.forEach((n=>{var r,s;!1!==(null===(r=n.when)||void 0===r?void 0:r.call(n,t))&&(t[n.name]=null!==(s=e[n.name])&&void 0!==s?s:"function"==typeof n.default?n.default(t):n.default)})),b.filter((e=>{var n;return!1!==(null===(n=e.when)||void 0===n?void 0:n.call(e,t))})).map((e=>Object.entries(e).reduce(((e,[n,r])=>Object.assign(Object.assign({},e),{[n]:"function"==typeof r?r(t):r})),{})))})(e).reduce(((t,n)=>{var r;return Object.assign(Object.assign({},t),{[n.name]:null!==(r=e[n.name])&&void 0!==r?r:n.default})}),{}),Y=e=>F(void 0,void 0,void 0,(function*(){var t,n;q="installing";const a=J(e),o=null!==(t=a.dir)&&void 0!==t?t:"";yield((e,t,n)=>S(void 0,void 0,void 0,(function*(){var r;const a=(e=>{const t=Object.assign(Object.assign({prismaDB:"none"},e),{dbModule:"",dbUrl:""}),n=[{type:"add",files:"**",templateDir:`core/${e.server}`}];return"typeorm"===e.orm&&n.push({type:"add",files:"**",templateDir:`core/${e.server}-typeorm`}),"none"!==e.daemon&&n.push({type:"add",files:"**",templateDir:`daemon/${e.daemon}`}),t.dbModule="","prisma"===e.orm?(t.dbUrl="sqlite"===e.prismaDB?`file:${e.dbFile}`:`${e.prismaDB}://${e.dbUser}:${e.dbPass}@${e.dbHost}:${e.dbPort}/${e.dbName}`,n.push({type:"add",files:"**",templateDir:"orm/prisma"})):"typeorm"===e.orm&&(t.dbModule=`",\n    "${h[e.typeormDB].name}": "${h[e.typeormDB].ver}`,n.push({type:"add",files:"**",templateDir:"orm/typeorm"})),"none"!==e.testing&&(n.push({type:"add",files:"**",templateDir:`testing/${e.testing}`}),n.push({type:"add",files:"**",templateDir:`testing/${e.client}`})),"none"!==e.ci&&n.push({type:"add",files:"**",templateDir:`ci/${e.ci}`}),{answers:t,actions:[{type:"add",files:"**",templateDir:`client/${e.client}`},{type:"add",files:"server/**",templateDir:""},...n,{type:"move",patterns:{gitignore:".gitignore"}}]}})(e),o=null!==(r=null!=n?n:e.dir)&&void 0!==r?r:"";for(const e of a.actions)"add"===e.type?yield(0,P.majo)().source([e.files],{baseDir:s().resolve(t,"templates",e.templateDir)}).use((e=>{Object.keys(e.files).filter((e=>!j()(e)||".snap"===s().extname(e))).forEach((t=>{e.writeContents(t,O().render(e.files[t].contents.toString().replace(/\r/g,""),a.answers))}))})).dest(o):"move"===e.type&&(yield Promise.all(Object.keys(e.patterns).map((t=>S(void 0,void 0,void 0,(function*(){const n=s().join(o,t),r=s().join(o,e.patterns[t]);yield u().promises.copyFile(n,r),yield u().promises.unlink(n)}))))))})))(Object.assign(Object.assign({},a),{clientPort:ne.client,serverPort:yield M()}),__dirname),yield(e=>{return t=void 0,n=void 0,a=function*(){var t,n;const s=null!==(t=e.dir)&&void 0!==t?t:"",a=null!==(n=e.pm)&&void 0!==n?n:"";f().sync("git",["init"],{stdio:"ignore",cwd:s}),yield N(s,a),yield N(`${s}/server`,a),f().sync(a,["run","build:types"],{cwd:s,stdio:"inherit"});const o=s!==process.cwd(),i=(0,r.relative)(process.cwd(),s),l=o?B()`\n\t{cyan cd ${i}}\n`:"",c=`${a}${"npm"===a?" run":""}`;console.log(B()`\nðŸŽ‰  {bold Successfully created project} {cyan ${s}}\n`),console.log(B()`  {bold To get started:}`),"none"===e.orm||"typeorm"!==e.orm&&"sqlite"===e.prismaDB||console.log(B()`\t{cyan (start ${"prisma"===e.orm?e.prismaDB:e.typeormDB} server yourself)}`),console.log(B()`${l}\t{cyan ${c} dev}\n`),console.log(B()`  {bold To build & start for production:}`),"none"===e.orm||"typeorm"!==e.orm&&"sqlite"===e.prismaDB||console.log(B()`\t{cyan (start ${"prisma"===e.orm?e.prismaDB:e.typeormDB} server yourself)}`),console.log(B()`${l}\t{cyan ${c} build}`),console.log(B()`\t{cyan ${c} start}\n`)},new((s=void 0)||(s=Promise))((function(e,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function i(e){try{l(a.throw(e))}catch(e){r(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(o,i)}l((a=a.apply(t,n||[])).next())}));var t,n,s,a})(a),yield te.close(),f()(null!==(n=e.pm)&&void 0!==n?n:"npm",["run","dev"],{cwd:(0,r.resolve)(o),stdio:"inherit"}),delete H.answers.dir,delete H.answers.dbName,yield u().promises.writeFile(U,JSON.stringify(H),"utf8")})),Q=e=>F(void 0,void 0,void 0,(function*(){"waiting"===$()&&(H=Object.assign(Object.assign({},H),{answers:e}),u().existsSync(C)||(yield u().promises.mkdir(C)),yield u().promises.writeFile(U,JSON.stringify(H),"utf8"),yield Y(e))})),G=()=>({get:()=>({status:200,body:Object.assign({dir:process.argv[2]},H.answers)}),patch:({body:e})=>(Q(e),{status:204})});const W=require("mariadb");var K=n.n(W);const V=require("pg");const X=function(e,t){return e}((()=>({post:({body:e})=>{return t=void 0,n=void 0,s=function*(){var t;const n=J(e);if("none"===n.orm||"sqlite"===n.prismaDB)return{status:200,body:{enabled:!0}};try{const e={host:n.dbHost,port:+`${n.dbPort}`,user:n.dbUser,password:n.dbPass};if("mysql"===(null!==(t=n.prismaDB)&&void 0!==t?t:n.typeormDB)){const t=yield K().createConnection(e);"typeorm"===n.orm&&(yield t.query(`CREATE DATABASE IF NOT EXISTS ${n.dbName}`)),yield t.end()}else{const t=new V.Client(Object.assign(Object.assign({},e),{database:"postgres"}));yield t.connect(),"typeorm"===n.orm&&(yield t.query("SELECT datname FROM pg_database")).rows.every((e=>e.datname!==n.dbName))&&(yield t.query(`CREATE DATABASE ${n.dbName}`)),yield t.end()}return{status:200,body:{enabled:!0}}}catch(e){return{status:200,body:"prisma"===n.orm&&e.message.includes("allowPublicKeyRetrieval")?{enabled:!0}:{enabled:!1,err:e.message}}}},new((r=void 0)||(r=Promise))((function(e,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function i(e){try{l(s.throw(e))}catch(e){a(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(o,i)}l((s=s.apply(t,n||[])).next())}));var t,n,r,s}})));const z=function(e,t){return e}((()=>({get:()=>{return e=void 0,t=void 0,r=function*(){return{status:200,body:{status:$(),serverPort:yield M()}}},new((n=void 0)||(n=Promise))((function(s,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function i(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}l((r=r.apply(e,t||[])).next())}));var e,t,n,r}})));const Z=e=>(t,n)=>{const r=e(t);r.headers&&n.headers(r.headers),n.code(r.status).send(r.body)},ee=e=>(t,n)=>{return r=void 0,s=void 0,o=function*(){const r=yield e(t);r.headers&&n.headers(r.headers),n.code(r.status).send(r.body)},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{l(o.next(e))}catch(e){t(e)}}function i(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){var r;t.done?e(t.value):(r=t.value,r instanceof a?r:new a((function(e){e(r)}))).then(n,i)}l((o=o.apply(r,s||[])).next())}));var r,s,a,o};const te=o()(),ne={client:3e3};(0,p.getPortPromise)({port:ne.client}).then((e=>{return t=void 0,n=void 0,a=function*(){ne.client=e;const t=process.argv.indexOf("--answers");-1!==t?yield Q(I.reduce(((e,t)=>t.when(e)?(console.warn(t.warn),t.handler(e)):e),JSON.parse(process.argv[t+1]))):(te.register(l(),{root:s().join(__dirname,"../out")}),yield((e,t={})=>{var n;const r=null!==(n=t.basePath)&&void 0!==n?n:"",s=G(e),a=X(e),o=z(e);return e.get(`${r}/answers`,Z(s.get)),e.patch(`${r}/answers`,Z(s.patch)),e.post(`${r}/dbConnection`,ee(a.post)),e.get(`${r}/status`,ee(o.get)),e})(te,{basePath:"/api"}).listen(e));const n=yield d()(`http://localhost:${e}`);n.on("error",(()=>{console.log(`open http://localhost:${e} in the browser`)})),n.on("close",(()=>{console.log(`open http://localhost:${e} in the browser`)}))},new((r=void 0)||(r=Promise))((function(e,s){function o(e){try{l(a.next(e))}catch(e){s(e)}}function i(e){try{l(a.throw(e))}catch(e){s(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(o,i)}l((a=a.apply(t,n||[])).next())}));var t,n,r,a}))}},t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}return n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n(57)})().default;
>>>>>>> 2b75b16416ca8fc833a5f051a52ef6327402014f
